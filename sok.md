# Sok: 区块链中可供选择的共识协议的元分析

*摘要* - **区块链技术近来在公众， 在工业界和科研界都收到了广泛关注。 然而， 这些区块链系统现在由于可扩展性和安全性上的挑战还不能支持强大而大规模的应用。能解决这些挑战的最基本步骤就在共识层面。正因如此，工业界和学术界都在研究与开发更多可供选择的共识算法上投入巨大，尝试找到一个可以取代中本聪发明的比特币的共识算法。相比较工作量证明(PoW)，很多这些算法倾向于用权益证明(PoS)作为抗女巫攻击机制(Sybil control mechanism)。但到现在为止对这些可供选择的共识协议并没有一个全面的严格的比较。这篇文章对于主要的区块链协议提供了一个系统化的理解，了解他们共同面对的挑战和解决方式，并提供了一个比较这些协议的正式结构。我们把这些协议根据网络，对抗性和经济模型进行拆解，深入理解他们在选择提出者(proposer)和委员会(committees)，传播(propagation)和确定性(finality)时遇到的共同挑战**

## 1. 介绍
区块链技术提供了一个翻天覆地的创新，质疑了分布式计算和金融理论中长期确立的范例，并为去中心化网络应用提供了一个创新性的平台。尤其是虚拟货币(像是比特币或者以太坊)相比较传统货币而言的诸多明显优势已经吸引了很多注意，包括更高的透明度和更能抵抗伪造的能力，以及一些其他的优势[8]。这些货币的交易由一种分布式账本支持，而这种分布式账本又由一种被称作区块链的数据结构构成。区块链这里指代“一种去中心化的，可复制的，不可改变的，并防止篡改的日志”[7]。更关键的是，“在区块链上的数据不能被删除，并且任何人都能读到并证实区块链上数据的正确性”[7]。区块链由*区块*组成，区块是包含交易的结构。尤为关键的是，进一步说，区块链中一个重要的方面是无需许可的共识，至少在中本聪最初的实例中，“任何人(无需获得任何中央或者分布式权威的准许即可)可以加入(或离开)协议的运行，并且没有认证机制”。此外，参与者可以“自愿”加入或者离开系统[30]。

那些让区块链变得更安全并在账本中增加新的交易的计算机被称为*矿工 (miner)*。这些矿工在“最长链”上挖矿从而和别的矿工在账本的历史上达成共识并得到金钱上的激励。这个过程被称作中本聪共识，由一个被称作*工作量证明 (PoW)*的步骤支持[7]。 

### 1.1 问题定义
在中本聪定义的工作量证明中，其本身对于能源和运算力都是一个浪费，并且中本聪共识相较于一致性(consistency)更倾向于可用性(availability)。正因如此，很多人提出了其他可供选择的共识协议，他们中的许多倾向于用权益证明(PoS)作为抗女巫攻击机制(Sybil control mechanism)并提供多种不同的最终性保证(finality gaurantee)，包括偏袒可用性(availability)和偏袒一致性(consistency)的协议。在一个PoS系统里，共识是通过验证者(validator)达成的一致意见而形成，这些验证者把自己的虚拟货币抵押给网络。这些验证者和PoW系统中的矿工相似。然而，在PoS中， 验证者通过存放（抵押）虚拟货币的方式在新的区块上提出建议（propose）或者投票（vote）。相比较于PoW在比特币中既是抗女巫攻击机制(Sybil control mechanism)又是随机选择区块创建者的根源，PoS则仅仅是一个抗女巫攻击机制(Sybil control mechanism)，因此它需要一个不同的随机性协议来选择提名人(proposer)。PoS的支持者提出PoS可以解决PoW所面临的很多挑战，比如低效能，高延迟和趋中心化风险，更多例子就不一一陈述[15]。

现今，还没有一个充分并全面的关于其他可供选择的倾向于PoS的共识协议的分析。这个类别的协议已经被很多研究组织和在这个领域的很多项目深入的探索，并有很强的潜力去驱动一个扩展性更好，效能更高的区块链平台。创建一个共识算法从根本上具有一定复杂度，并需要深入理解先前的工作从而更有效的优化现有方案或是将已经存在的方案应用到一个特殊的用例(use case)上。我们的目标是提供一个对于主要可供选择的区块链共识协议的全面分析，把这些协议放在相同的框架中评估，从而达到准确而有效的比较。这里我们把协议用网络，对抗性和经济模型分类，并研究他们在提议者和委员会选择，信息传递，最终确定性，如何处理流失，生成随机的安全性，网络分区解析，以及可扩展性上的遇到的共同挑战。我们将会特别聚焦在对Tendermint [37], Thunderella [36], Algorand [4], Dfinity [13], Ouroboros Genesis [25], Casper FFG [39] 和 Casper TFG [40]的分析上。

### 1.2 相关工作
这篇文章延续了学术界文章的更替，为比特币和其相关的话题提供了系统的回顾和元分析。Bonneau及其他人[9]对虚拟货币进行了一个数学上的评估。Zohar [34]研究了关于区块链，尤其是比特币的可扩展问题。Pass和Shi[30] 用数学分析了基于区块链的公共(permissionless)，冷清(sleepy)共识，严格证明了这种共识比经典共识更加困难。Croman及其他人[12]对于可扩展性的瓶颈发表了一个意见书，并提供了解决方案。

实际上，已经有学术文章，包括Vukolic[33]，鼓励从PoW转移到PoS，并呼吁提供更严格的分析框架。基于安全性和分叉阻性(fork-resistance)，这进一步鼓励我们使用经典BFT协议而不是PoW。Bano及其他人[7]研究了区块链的共识协议，并调查了不同类型的可在公共(permissionless)环境中使用的可替代共识协议。Gervais和其他人[19]则描述了一个可以评估PoW区块链安全性和性能的框架。

### 1.3 问题定义
#### 1.3.1 经典环境下的公式算法.  
共识问题
